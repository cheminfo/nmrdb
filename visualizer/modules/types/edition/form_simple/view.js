define(["modules/default/defaultview","src/util/datatraversing","src/util/api","lib/formcreator/formcreator"],function(a,b,c,d){function e(){}return e.prototype=$.extend(!0,{},a,{init:function(){this.dom=$("<div />"),this.module.getDomContent().html(this.dom),this.callback=null,this.resolveReady()},inDom:function(){var a,b,c=this,e=this.module.getConfiguration("structure")||[],f=this.module.getConfiguration("tpl_file"),g=this.module.getConfiguration("trigger"),h=this.module.getConfiguration("tpl_html"),i={},j={sections:{main:{groups:{main:{options:{type:"list",multiple:!1},fields:d.makeStructure(e)}}}}};b=f?$.get(f,{}):h;var k=function(){if(console.log("a"),!c.lockEvents){var a=new DataObject(this.getValue(),!0);c.formValue=a;var b,d=c.module.getDataFromRel("input_object"),e=c.module.getConfiguration("structure")||[],f=new DataObject;if(console.log("d"),d)if(c.module.getConfiguration("replaceObj")){for(var g=0,h=e.length;h>g;g++)b=e[g].groups.general[0].searchOnField[0],d.setChild(b,c.form.sectionElements.main[0].groupElements.main[0].fieldElements[e[g].groups.general[0].name[0]][0].value,!0);c.module.model.dataTriggerChange(d)}else{for(var g=0,h=e.length;h>g;g++)b=e[g].groups.general[0].searchOnField[0],f.setChild(b,c.form.sectionElements.main[0].groupElements.main[0].fieldElements[e[g].groups.general[0].name[0]][0].value);console.log(f)}else f=a;c.module.controller.valueChanged(f)}};$.when(b).done(function(b){switch(b='<form><div style="position: relative;" class="form-sections-wrapper form-section-section-container"><div class="form-section" data-form-sectionname="main"><div class="form-section-group-container"><div class="form-group" data-form-groupname="main">'+b+"</div></div></div></div></form>",a=d.makeForm(),g){case"btn":var e=c.module.getConfiguration("btnLabel");a.addButton(e,{color:"blue"},$.proxy(k,a));break;case"change":i.onValueChanged=k}a.init(i),a.setStructure(j),a.onStructureLoaded().done(function(){a.fill({})}),a.onLoaded().done(function(){a.setTpl(b),c.dom.html(a.makeDomTpl()),a.inDom()})}),this.form=a},update:{input_object:function(a){var b=this;this.newValue(a),this.module.model.dataListenChange(a,function(){b.newValue(this)},"input_object")}},newValue:function(a){var b,c=this,d=this.module.getConfiguration("structure")||[];c.lockEvents=!0,c.nb=0;for(var e=0,f=d.length;f>e;e++)b=d[e].groups.general[0].searchOnField[0],function(b,e){c.nb++,a.getChild(e,!0).done(function(a){c.form.sectionElements.main[0].groupElements.main[0].fieldElements[d[b].groups.general[0].name[0]][0].value=a.get(),c.nb--,0==c.nb&&(c.lockEvents=!1)})}(e,b)},getDom:function(){return this.dom},typeToScreen:{}}),e});