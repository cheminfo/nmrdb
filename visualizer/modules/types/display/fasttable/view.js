define(["require","modules/default/defaultview","src/util/util","src/util/api","src/util/domdeferred","src/util/datatraversing","src/util/typerenderer","src/util/context"],function(a,b,c,d,e,f,g,h){function i(){}return i.prototype=$.extend(!0,{},b,{init:function(){var a,b,d=this,e=this.module.getConfiguration("toggle");this.domTable=$("<table />",{cellpadding:0,cellspacing:0}).css({width:"100%"}),this.domHead=$("<thead />").appendTo(this.domTable),this.domBody=$("<tbody />").appendTo(this.domTable),this.selected=[],this.domTable.on("mouseover","tr",function(){if(this!==a){var b=$(this).index();isNaN(b)||d.module.controller.lineHover(d.module.data,b)}a=this}).on("mouseout","tr",function(){if(this===a){var b=$(this).index();isNaN(b)||d.module.controller.lineOut(d.module.data,b)}}).on("click","tr",function(){if(d.module.controller.lineClick(d.module.data,$(this).index()),e){console.log(e,d.selected),"single"==e&&void 0!==d.selected[0]&&(d.module.controller.onToggleOff(d.module.data,d.selected[0]),$(this).parent().children().eq(d.selected[0]).toggleClass("toggled"),d.selected=[]);var a=($(this),$(this).index());$(this).hasClass("toggled")?d.module.controller.onToggleOff(d.module.data,a):d.module.controller.onToggleOn(d.module.data,a),$(this).toggleClass("toggled"),console.log("Push"),d.selected.push(a)}}).on("click","th",function(){var a=$(this).attr("data-jpath-number"),c=d.module.getDataFromRel("list");b&&b.col===a?b.col===a&&(b.asc=!b.asc,b.span.toggleClass("up")):(b&&d.domTable.find('th[data-jpath-number="'+b.col+'"] .sort').remove(),b={asc:!0,col:a,span:$('<div class="sort up"></div>')},d.domTable.find('th[data-jpath-number="'+b.col+'"]').append(b.span)),c.sort(function(c,e){return(b.asc?1:-1)*(d.jpaths[f[a].jpath](c)>d.jpaths[f[a].jpath](e)?1:-1)}),d.blank.list.call(d),d.update.list.call(d,c)}),this.dom=this.domTable,this.module.getDomContent().html(this.dom),this.onResize();var f=this.module.getConfiguration("colsjPaths"),g=f.length,h=0;this.jpaths={};for(var i="<tr>";g>h;h++)f[h].jpath&&(c.addjPathFunction(this.jpaths,f[h].jpath),i+='<th data-jpath-number="'+h+'">'+f[h].name+"</th>");i+="</tr>";var j=this.module.getConfiguration("colorjPath");j&&(this.colorjpath=c.makejPathFunction(j)),this.domHead.html(i),this.resolveReady()},unload:function(){this.module.getDomContent().empty()},applyFilterToRow:function(a,b){this.filter&&this.filter(this.jqGrid,this.elements[a],b)},onResize:function(){!this.jqGrid},blank:{list:function(){if(this.module.data){var a,b=this.module.data.length;for(a=0;b>a;a++)this.module.data[a].unbindChange(this.module.getId())}}},update:{list:function(a){if("string"!==a.type&&a){this.selected=[],this.elements=a;{var b=this,c=this.module.getConfiguration("colsjPaths"),e=(this.module.getConfiguration("nbLines")||20,""),f=0,g=a.get().length;c.length}for(this.module.data=a,f=0;g>f;f++)e+=this.buildElement(a.getChildSync(f),f);this.domBody.html(e),this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){for(d.killHighlight(b.module.getId()),f=0;g>f;f++)!function(a){d.listenHighlight(b.module.data[a],function(c){b.doHighlight(a,c)},!1,b.module.getId());var c=b.domBody.find("#"+b.module.getId()+"_"+a);b.module.model.dataListenChange(b.module.data.get(a),function(){c.replaceWith(c=$(b.buildElement(this,a,!0)))},"list"),b.module.data.get(a).removable&&h.listen(c.get(0),[['<li><a><span class="ui-icon ui-icon-close"></span> Remove</a></li>',function(){b.onActionReceive.removeRowById.call(b,a)}]])}(f)},1e3),this.list=!0,this.showList=!1,this.updateVisibility()}},showList:function(a){a instanceof Array&&(this.showList=a,this.updateVisibility())}},updateVisibility:function(){if(this.showList&&this.list)for(var a,b=this.showList,c=b.length,d=this.module.getId()+"_",e=0;c>e;e++)a=document.getElementById(d+e),b[e]?a.removeAttribute("style"):a.setAttribute("style","display:none")},buildElement:function(a,b){var c,d=this.module.getConfiguration("colsjPaths"),e="",g=d.length;for(e+="<tr",this.colorjpath&&(e+=' style="background-color: '+this.colorjpath(a)+';"'),e+=' id="'+this.module.getId()+"_"+b+'" ',e+=">",c=0;g>c;c++)d[c].jpath&&(e+="<td>",e+=f.get(this.getValue(f.get(a),d[c].jpath))||"",e+="</td>");return e+="</tr>"},doHighlight:function(a,b){this.domBody.find("tr").eq(a)[b?"addClass":"removeClass"]("ci-highlight")},getValue:function(a,b){return this.jpaths[b]?this.jpaths[b](a):""},getDom:function(){return this.dom},onActionReceive:{addRow:function(a){this.elements=this.elements||[],this.module.getDataFromRel("list").push(a);var b=this.elements.length-1,c=this.buildElement(a,b);this.domBody.append(c)},removeRow:function(a){console.log(a),this.onActionReceive.removeRowById.call(this,this.module.getDataFromRel("list").indexOf(a))},removeRowById:function(a){if(console.log(a),!(0>a)){var b=this.module.getDataFromRel("list").splice(a,1);b[0].unbindChange(this.module.getId());var c;(c=this.selected.indexOf(a))>-1&&this.selected.splice(c,1),console.log(this.selected),this.domBody.children().eq(a).remove()}},toggleOff:function(a){console.log("Toggle Off");var b=this.module.getDataFromRel("list").indexOf(a);console.log(b,this.module.getDataFromRel("list"),a),-1!=b&&(this.module.controller.onToggleOff(this.module.data,b),this.domBody.children().eq(b).removeClass("toggled"))}},typeToScreen:{}}),i});