define(["require","modules/default/defaultview","src/util/util","src/util/api","src/util/domdeferred","src/util/datatraversing","src/util/typerenderer","src/util/context"],function(a,b,c,d,e,f,g,h){function i(){}return i.prototype=$.extend(!0,{},b,{init:function(){var a,b=this,d=this.module.getConfiguration("toggle");this.domTable=$("<table />",{cellpadding:0,cellspacing:0}).css({width:"100%"}),this.domHead=$("<thead />").appendTo(this.domTable),this.domBody=$("<tbody />").appendTo(this.domTable),this.selected=[],this.domTable.on("mouseenter","tbody tr",function(){console.log("mouse enter");var a=$(this).index();isNaN(a)||b.module.controller.lineHover(b.module.data,a)}).on("mouseleave","tbody tr",function(){var a=$(this).index();isNaN(a)||b.module.controller.lineOut(b.module.data,a)}).on("click","tr",function(){if(b.module.controller.lineClick(b.module.data,$(this).index()),d){console.log(d,b.selected),"single"==d&&void 0!==b.selected[0]&&(b.module.controller.onToggleOff(b.module.data,b.selected[0]),$(this).parent().children().eq(b.selected[0]).toggleClass("toggled"),b.selected=[]);var a=($(this),$(this).index());$(this).hasClass("toggled")?b.module.controller.onToggleOff(b.module.data,a):b.module.controller.onToggleOn(b.module.data,a),$(this).toggleClass("toggled"),console.log("Push"),b.selected.push(a)}}).on("click","th",function(){var c=$(this).attr("data-jpath-number"),d=b.module.getDataFromRel("list");a&&a.col===c?a.col===c&&(a.asc=!a.asc,a.span.toggleClass("up")):(a&&b.domTable.find('th[data-jpath-number="'+a.col+'"] .sort').remove(),a={asc:!0,col:c,span:$('<div class="sort up"></div>')},b.domTable.find('th[data-jpath-number="'+a.col+'"]').append(a.span)),d.sort(function(d,f){return(a.asc?1:-1)*(b.jpaths[e[c].jpath](d)>b.jpaths[e[c].jpath](f)?1:-1)}),b.blank.list.call(b),b.update.list.call(b,d)}),this.dom=this.domTable,this.module.getDomContent().html(this.dom),this.onResize();var e=this.module.getConfiguration("colsjPaths"),f=e.length,g=0;this.jpaths={};for(var h="<tr>";f>g;g++)e[g].jpath&&(c.addjPathFunction(this.jpaths,e[g].jpath),h+='<th data-jpath-number="'+g+'">'+e[g].name+"</th>");h+="</tr>";var i=this.module.getConfiguration("colorjPath");i&&(this.colorjpath=c.makejPathFunction(i)),this.domHead.html(h),this.resolveReady()},unload:function(){this.module.getDomContent().empty()},applyFilterToRow:function(a,b){this.filter&&this.filter(this.jqGrid,this.elements[a],b)},onResize:function(){!this.jqGrid},blank:{list:function(){if(this.module.data){var a,b=this.module.data.length;for(a=0;b>a;a++)this.module.data[a].unbindChange(this.module.getId())}}},update:{list:function(a){if("string"!==a.type&&a){this.selected=[],this.elements=a;{var b=this,c=this.module.getConfiguration("colsjPaths"),e=(this.module.getConfiguration("nbLines")||20,""),f=0,g=a.get().length;c.length}for(this.module.data=a,f=0;g>f;f++)e+=this.buildElement(a.getChildSync(f),f);this.domBody.html(e),this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){for(d.killHighlight(b.module.getId()),f=0;g>f;f++)!function(a){d.listenHighlight(b.module.data[a],function(c){b.doHighlight(a,c)},!1,b.module.getId());var c=b.domBody.find("#"+b.module.getId()+"_"+a);b.module.model.dataListenChange(b.module.data.get(a),function(){c.replaceWith(c=$(b.buildElement(this,a,!0)))},"list"),b.module.data.get(a).removable&&h.listen(c.get(0),[['<li><a><span class="ui-icon ui-icon-close"></span> Remove</a></li>',function(){b.onActionReceive.removeRowById.call(b,a)}]])}(f)},1e3),this.list=!0,this.showList=!1,this.updateVisibility()}},showList:function(a){a instanceof Array&&(this.showList=a,this.updateVisibility())}},updateVisibility:function(){if(this.showList&&this.list)for(var a,b=this.showList,c=b.length,d=this.module.getId()+"_",e=0;c>e;e++)a=document.getElementById(d+e),b[e]?a.removeAttribute("style"):a.setAttribute("style","display:none")},buildElement:function(a,b){var c,d=this.module.getConfiguration("colsjPaths"),e="",g=d.length;for(e+="<tr",this.colorjpath&&(e+=' style="background-color: '+this.colorjpath(a)+';"'),e+=' id="'+this.module.getId()+"_"+b+'" ',e+=">",c=0;g>c;c++)d[c].jpath&&(e+="<td>",e+=f.get(this.getValue(f.get(a),d[c].jpath))||"",e+="</td>");return e+="</tr>"},doHighlight:function(a,b){this.domBody.find("tr").eq(a)[b?"addClass":"removeClass"]("ci-highlight")},getValue:function(a,b){return this.jpaths[b]?this.jpaths[b](a):""},getDom:function(){return this.dom},onActionReceive:{addRow:function(a){this.elements=this.elements||[],this.module.getDataFromRel("list").push(a);var b=this.elements.length-1,c=this.buildElement(a,b);this.domBody.append(c)},removeRow:function(a){console.log(a),this.onActionReceive.removeRowById.call(this,this.module.getDataFromRel("list").indexOf(a))},removeRowById:function(a){if(console.log(a),!(0>a)){var b=this.module.getDataFromRel("list").splice(a,1);b[0].unbindChange(this.module.getId());var c;(c=this.selected.indexOf(a))>-1&&this.selected.splice(c,1),console.log(this.selected),this.domBody.children().eq(a).remove()}},toggleOff:function(a){console.log("Toggle Off");var b=this.module.getDataFromRel("list").indexOf(a);console.log(b,this.module.getDataFromRel("list"),a),-1!=b&&(this.module.controller.onToggleOff(this.module.data,b),this.domBody.children().eq(b).removeClass("toggled"))}},typeToScreen:{}}),i});